# План масштабирования Squad Invasion Platform

## Текущее состояние

**Технологический стек:**

- Next.js 16 (App Router, React 19)
- TypeScript 5
- Drizzle ORM + Supabase (базовая схема)
- Tailwind CSS + shadcn/ui
- next-intl (RU/EN локализация)
- Zod для валидации
- Google Calendar API интеграция

**Текущий функционал:**

- Лендинг с секциями (hero, events, team, gallery, schedule)
- Отображение событий из Google Calendar
- Двуязычность (RU/EN)
- Базовая схема БД (users таблица, не используется)

## Архитектурные решения

**Подход:** Монолитное приложение с постепенным выделением сервисов при необходимости

**База данных:** Supabase (PostgreSQL под капотом)

- Использование Supabase как BaaS платформы
- Расширение схемы в `shared/schema.ts`
- Миграции через Drizzle Kit
- Supabase предоставляет: базу данных, storage, realtime subscriptions

**Аутентификация:** Supabase Auth или NextAuth.js (Auth.js) v5

- Supabase Auth (рекомендуется): встроенная аутентификация с OAuth
- NextAuth.js как альтернатива: OAuth провайдеры (Steam, Discord)
- Email/password как fallback
- JWT сессии

**API:** Next.js Route Handlers (App Router)

- RESTful API в `src/app/api/`
- Server Actions для форм

**Файловое хранилище:**

- Supabase Storage (рекомендуется, входит в платформу)
- Vercel Blob Storage (альтернатива для MVP)
- S3-совместимое хранилище (для продакшена)

**Уведомления:**

- Email: Resend или SendGrid
- Push: Web Push API
- Discord: Webhooks + Bot API

## Фазы разработки

### Фаза 0: Подготовка инфраструктуры (2-3 недели)

**Цель:** Подготовить базовую инфраструктуру для масштабирования

**Задачи:**

- Настройка Supabase проекта (база данных, storage, auth)
- Расширение Drizzle схемы (users, events, clans, registrations)
- Настройка Supabase Auth или NextAuth.js
- Создание базовых API роутов
- Настройка CI/CD pipeline
- Миграция данных из Google Calendar (опционально)

**Результат:** Готовая инфраструктура для разработки основных функций

---

### Фаза 1: MVP - Базовая платформа (6-8 недель)

**Цель:** Минимально жизнеспособный продукт для организации ивентов

**Ключевые функции:**

1. **Аутентификация и профили** (2 недели)

   - Регистрация/авторизация (Steam, Discord OAuth)
   - Базовый профиль игрока
   - Привязка Steam аккаунта
   - Настройки приватности

2. **Управление ивентами** (3 недели)

   - Создание ивентов (формат, режим, дата, карта)
   - Типы: клановые бои, скримы, турниры
   - Режимы: Invasion, Territory Control, RAAS, AAS
   - Редактирование/отмена ивентов
   - Публичные/приватные ивенты

3. **Регистрация на ивенты** (2 недели)

   - Индивидуальная регистрация
   - Командная регистрация
   - Ограничения по количеству участников
   - Резервный список (waitlist)

4. **Базовый календарь** (1 неделя)
   - Расширенный календарь ивентов
   - Фильтры (режим, формат, дата)
   - Интеграция с существующим Google Calendar (опционально)

**Результат:** Пользователи могут регистрироваться, создавать ивенты и записываться на них

---

### Фаза 2: v1.0 - Кланы и команды (4-6 недель)

**Цель:** Добавить систему кланов и командной игры

**Ключевые функции:**

1. **Система кланов** (3 недели)

   - Создание и управление кланами
   - Роли: лидер, офицер, участник
   - Приглашения в клан
   - Профиль клана (логотип, описание)
   - Управление составом

2. **Командная регистрация** (2 недели)

   - Регистрация клана на ивент
   - Автоматическое формирование команд
   - Ручное назначение команд организатором
   - Балансировка команд

3. **Базовая статистика** (1 неделя)
   - История участия в ивентах
   - Базовая статистика игрока
   - Статистика клана

**Результат:** Кланы могут создаваться, управляться и регистрироваться на ивенты командой

---

### Фаза 3: v1.5 - Планирование и заметки (3-4 недели)

**Цель:** Добавить инструменты для планирования тактик

**Ключевые функции:**

1. **Персональные заметки** (1.5 недели)

   - Создание/редактирование заметок
   - Категории (тактика, разведка, координация)
   - Поиск по заметкам
   - Прикрепление файлов (скриншоты, карты)

2. **Совместные заметки** (1.5 недели)

   - Заметки для кланов/команд
   - Шаблоны тактических планов
   - Экспорт заметок
   - Права доступа

3. **Интеграция с ивентами** (1 неделя)
   - Привязка заметок к ивентам
   - Быстрый доступ к планам перед матчем

**Результат:** Игроки и кланы могут создавать и делиться тактическими планами

---

### Фаза 4: v2.0 - Лидерборды и расширенная статистика (4-5 недель)

**Цель:** Добавить соревновательные элементы и детальную аналитику

**Ключевые функции:**

1. **Система рейтинга** (2 недели)

   - Расчет рейтинга игроков (ELO или кастомный алгоритм)
   - Расчет рейтинга кланов
   - История изменений рейтинга

2. **Лидерборды** (1.5 недели)

   - Глобальные лидерборды (игроки, кланы)
   - Лидерборды по категориям (K/D, победы, участие)
   - Сезонные лидерборды
   - Фильтры и поиск

3. **Расширенная статистика** (1.5 недели)
   - Детальная статистика по ивентам
   - Графики прогресса
   - Сравнение статистики
   - История матчей с результатами

**Результат:** Пользователи могут отслеживать свой прогресс и соревноваться

---

### Фаза 5: v2.5 - Коммуникация и уведомления (3-4 недели)

**Цель:** Улучшить взаимодействие между пользователями

**Ключевые функции:**

1. **Система уведомлений** (2 недели)

   - Уведомления о предстоящих ивентах
   - Напоминания о регистрации
   - Уведомления о результатах
   - Email и push уведомления
   - Настройки уведомлений

2. **Коммуникация** (1.5 недели)

   - Встроенные сообщения между игроками
   - Комментарии к ивентам
   - Чаты для команд/кланов
   - Интеграция с Discord (webhooks)

3. **Модерация** (0.5 недели)
   - Базовая система модерации
   - Жалобы и баны
   - Логи действий

**Результат:** Улучшенная коммуникация и информированность пользователей

---

### Фаза 6: v3.0 - Продвинутые функции (5-6 недель)

**Цель:** Добавить продвинутые функции для опытных пользователей

**Ключевые функции:**

1. **Матчмейкинг** (2 недели)

   - Автоматический подбор команд по рейтингу
   - Система очередей
   - Балансировка команд

2. **Аналитика и отчеты** (2 недели)

   - Аналитика по ивентам
   - Отчеты для организаторов
   - Дашборды для администраторов
   - Экспорт данных

3. **Дополнительные функции** (1-2 недели)
   - Система достижений/бейджей
   - Галерея скриншотов/видео
   - Реферальная программа
   - Система отзывов

**Результат:** Полнофункциональная платформа с продвинутыми возможностями

---

## Технический роадмэп

### База данных (Supabase + Drizzle ORM)

**Использование Supabase:**

- Supabase предоставляет PostgreSQL базу данных через свой API
- Drizzle ORM работает с Supabase через стандартный PostgreSQL connection string
- Supabase также предоставляет: Storage, Realtime subscriptions, Edge Functions
- Миграции выполняются через Drizzle Kit к Supabase проекту

**Расширение схемы в `shared/schema.ts`:**

```typescript
// Основные таблицы
- users (расширить: steam_id, discord_id, avatar, rating, etc.)
- events (id, title, type, mode, date, organizer_id, max_participants, etc.)
- clans (id, name, tag, description, logo, leader_id, rating, etc.)
- clan_members (clan_id, user_id, role, joined_at)
- event_registrations (event_id, user_id, clan_id, status, registered_at)
- event_teams (event_id, team_name, players[])
- notes (id, user_id, clan_id, title, content, category, event_id, created_at)
- match_results (event_id, team1_id, team2_id, winner_id, score, stats)
- user_stats (user_id, kd_ratio, wins, losses, events_participated, etc.)
- leaderboards (type, period, rankings[])
```

### API структура

**`src/app/api/` структура:**

```
api/
├── auth/
│   ├── [...nextauth]/
│   └── callback/
├── users/
│   ├── [id]/
│   └── me/
├── events/
│   ├── route.ts (GET, POST)
│   └── [id]/
│       ├── route.ts (GET, PUT, DELETE)
│       ├── register/
│       └── results/
├── clans/
│   ├── route.ts
│   └── [id]/
│       ├── route.ts
│       ├── members/
│       └── invite/
├── notes/
│   ├── route.ts
│   └── [id]/
├── leaderboards/
│   └── route.ts
└── stats/
    └── route.ts
```

### Компоненты

**Новые компоненты в `src/components/`:**

```
components/
├── auth/
│   ├── login-form.tsx
│   ├── register-form.tsx
│   └── oauth-buttons.tsx
├── profile/
│   ├── user-profile.tsx
│   ├── profile-stats.tsx
│   └── profile-settings.tsx
├── events/
│   ├── event-create-form.tsx
│   ├── event-card.tsx
│   ├── event-details.tsx
│   ├── event-registration.tsx
│   └── event-calendar.tsx
├── clans/
│   ├── clan-card.tsx
│   ├── clan-profile.tsx
│   ├── clan-members.tsx
│   └── clan-invite.tsx
├── notes/
│   ├── note-editor.tsx
│   ├── note-list.tsx
│   └── note-templates.tsx
├── leaderboards/
│   ├── leaderboard-table.tsx
│   └── leaderboard-filters.tsx
└── admin/
    ├── admin-dashboard.tsx
    └── moderation-panel.tsx
```

### Страницы

**Новые страницы в `src/app/[locale]/`:**

```
[locale]/
├── dashboard/ (личный кабинет)
├── events/
│   ├── page.tsx (список)
│   ├── create/
│   └── [id]/
├── clans/
│   ├── page.tsx
│   ├── create/
│   └── [id]/
├── notes/
│   ├── page.tsx
│   └── [id]/
├── leaderboards/
└── admin/
```

## Оценка времени и ресурсов

**Общая оценка:** 23-30 недель (5.5-7.5 месяцев)

**Команда:**

- 1-2 Full-stack разработчика
- 1 UI/UX дизайнер (частичная занятость)
- 1 DevOps (частичная занятость, для настройки инфраструктуры)

**По фазам:**

- Фаза 0: 2-3 недели
- Фаза 1 (MVP): 6-8 недель
- Фаза 2: 4-6 недель
- Фаза 3: 3-4 недели
- Фаза 4: 4-5 недель
- Фаза 5: 3-4 недели
- Фаза 6: 5-6 недель

## Риски и зависимости

**Технические риски:**

- Интеграция с Steam API (может потребовать верификацию)
- Масштабирование базы данных при росте пользователей (Supabase автоматически масштабируется)
- Производительность при большом количестве ивентов
- Ограничения бесплатного плана Supabase (при необходимости перейти на платный)

**Зависимости:**

- Фаза 1 зависит от Фазы 0 (инфраструктура)
- Фаза 2 зависит от Фазы 1 (базовая система ивентов)
- Фаза 4 зависит от Фазы 2 (система кланов для рейтинга)

**Меры по снижению рисков:**

- Раннее тестирование интеграций (Steam, Discord)
- Оптимизация запросов к БД с самого начала
- Постепенное масштабирование инфраструктуры

## Метрики успеха

**MVP (Фаза 1):**

- 100+ зарегистрированных пользователей
- 10+ созданных ивентов в месяц
- 50+ регистраций на ивенты

**v1.0 (Фаза 2):**

- 20+ активных кланов
- 5+ клановых ивентов в месяц

**v2.0 (Фаза 4):**

- 500+ активных пользователей
- Еженедельные активные пользователи: 30%+
- Средний рейтинг игроков отслеживается

## Приоритизация

**Критичные функции (MVP):**

1. Аутентификация
2. Создание ивентов
3. Регистрация на ивенты
4. Базовый календарь

**Важные функции (v1.0-v2.0):**

1. Система кланов
2. Лидерборды
3. Планирование и заметки
4. Расширенная статистика

**Желательные функции (v2.5-v3.0):**

1. Матчмейкинг
2. Продвинутая аналитика
3. Система достижений
4. Мобильное приложение
